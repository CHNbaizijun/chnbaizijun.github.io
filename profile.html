<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心 | 白子俊</title>
    <link rel="stylesheet" href="assets/font-awesome/css/all.min.css">
    <style>
        :root {
            --primary: #6D8B74;
            --secondary: #94B49F;
            --accent: #9DAB86;
            --light: #F5F0E1;
            --white: #FFFFFF;
            --dark: #4D4D4D;
            --alert-red: #ff4444;
            --input-font-size: 18px;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            font-family: "AlibabaPuHuiTi", sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* 页眉样式 */
        .profile-header {
            margin-bottom: 40px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 20px;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            margin-bottom: 30px;
            color: var(--primary);
            text-decoration: none;
            font-size: 16px;
        }

        .back-button i {
            margin-right: 8px;
        }

        /* 主内容区 */
        .profile-container {
            background: var(--white);
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        /* 使用说明 */
        .usage-alert {
            color: var(--alert-red);
            border: 2px solid var(--alert-red);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 30px;
            font-weight: bold;
            font-size: 16px;
        }

        /* 信息展示区 */
        .info-display {
            background: var(--light);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .info-item {
            margin: 15px 0;
            display: flex;
            align-items: baseline;
            font-size: 17px;
        }

        .info-label {
            width: 120px;
            color: var(--primary);
            font-weight: 500;
            flex-shrink: 0;
        }

        /* 增强型输入框 */
        .form-group {
            margin-bottom: 30px;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--secondary);
            border-radius: 8px;
            margin-top: 10px;
            font-size: var(--input-font-size);
            transition: all 0.3s ease;
        }

        input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 8px rgba(157, 171, 134, 0.3);
        }

        /* 按钮容器 */
        .action-buttons {
            display: flex;
            gap: 25px;
            margin-top: 50px;
        }

        .cta-button {
            padding: 14px 35px;
            background-color: var(--accent);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: transform 0.2s ease;
        }

        .btn-danger {
            background-color: #ff6b6b !important;
        }

        .cta-button:hover {
            transform: translateY(-2px);
        }

        /* 页脚增强 */
        footer {
            background-color: var(--dark);
            color: var(--white);
            padding: 60px 20px 30px;
            text-align: center;
            margin-top: 60px;
            border-radius: 8px;
            font-size: 16px;
        }

        .contact-info p {
            margin: 12px 0;
            opacity: 0.9;
        }

        .social-icons {
            margin: 35px 0;
        }

        .social-icons a {
            color: var(--white);
            margin: 0 18px;
            font-size: 24px;
            transition: opacity 0.3s ease;
        }

        .social-icons a:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <!-- 页眉 -->
    <header class="profile-header">
        <a href="index.html" class="back-button">
            <i class="fas fa-arrow-left"></i>返回首页
        </a>
        <h1 style="font-size: 28px;">个人账户中心</h1>
    </header>

    <div class="profile-container">
        <!-- 操作说明 -->
        <div class="usage-alert">
            ※ 操作说明：从上到下按需修改，无需更改请保持原状或留空。红色星号(*)为必填项
        </div>

        <!-- 账户信息展示 -->
        <div class="info-display">
            <div class="info-item">
                <div class="info-label">用户ID：</div>
                <div id="infoId" class="info-content">--</div>
            </div>
            <div class="info-item">
                <div class="info-label">注册邮箱：</div>
                <div id="infoEmail" class="info-content">--</div>
            </div>
            <div class="info-item">
                <div class="info-label">注册时间：</div>
                <div id="infoCreated" class="info-content">--</div>
            </div>
            <div class="info-item">
                <div class="info-label">最后登录：</div>
                <div id="infoLogin" class="info-content">--</div>
            </div>
        </div>

        <!-- 信息编辑表单 -->
        <form id="profileForm">
            <div class="form-group">
                <label>修改昵称 <span style="color:var(--alert-red)">*</span></label>
                <input type="text" id="profileName" 
                       placeholder="2-16位字符（必填）"
                       required>
            </div>

            <div class="form-group">
                <label>修改邮箱 <span style="color:var(--alert-red)">*</span></label>
                <input type="email" id="profileEmail" 
                       placeholder="输入有效邮箱地址（必填）"
                       required>
            </div>

            <div class="form-group">
                <label>修改密码</label>
                <input type="password" id="newPassword" 
                       placeholder="留空则不修改（至少8位）">
            </div>

            <div class="action-buttons">
                <button type="submit" class="cta-button">保存更改</button>
                <button type="button" class="cta-button btn-danger" 
                        id="deleteAccount">注销账户</button>
            </div>
        </form>
    </div>

    <!-- 页脚 -->
    <footer>
        <p>笃行致远 事必尽善</p>
        <div class="contact-info">
            <p>微信: FreedomOfSpace</p>
            <p>Email: CHNbaizijun@163.com</p>
        </div>
        <div class="social-icons">
            <a href="#"><i class="fab fa-weixin"></i></a>
            <a href="#"><i class="fab fa-weibo"></i></a>
            <a href="#"><i class="fab fa-qq"></i></a>
        </div>
        <div class="beian">
            <a href="https://beian.miit.gov.cn">京ICP备XXXXXXXX号</a>
        </div>
    </footer>

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/av-min.js"></script>
    <script>
    AV.init({
        appId: '0lpjg6Zgwua9jqUZDeJMVxpr-gzGzoHsz',
        appKey: 'gV34QMHiVXzzDiS4GdyXtZt9',
        serverURL: 'https://0lpjzgw.lc-cn-n1-shared.com'
    });

    function loadProfile() {
        const user = AV.User.current();
        if (!user) {
            alert('请先登录');
            window.location.href = 'index.html';
            return;
        }

        // 显示完整账户信息
        $('#infoId').text(user.id); 
        $('#infoEmail').text(user.getEmail());
        $('#infoCreated').text(new Date(user.createdAt).toLocaleString());
        $('#infoLogin').text(new Date(user.updatedAt).toLocaleString());
        
        // 初始化表单数据
        $('#profileName').val(user.get('nickname') || user.getUsername());
        $('#profileEmail').val(user.getEmail());
    }

    // 表单提交处理
    $('#profileForm').submit(async function(e) {
        e.preventDefault();
        const user = AV.User.current();
        if (!user) return;

        const newName = $('#profileName').val().trim();
        const newEmail = $('#profileEmail').val().trim();
        const newPassword = $('#newPassword').val();

        try {
            // 增强验证逻辑
            if (!newName || newName.length < 2 || newName.length > 16) {
                throw new Error('昵称为2-16位必填内容');
            }
            if (!/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(newEmail)) {
                throw new Error('请输入有效的邮箱地址');
            }
            if (newPassword && newPassword.length < 8) {
                throw new Error('密码长度至少8位');
            }

            // 增量更新逻辑
            const changes = {};
            if (newName !== user.get('nickname')) {
                user.setUsername(newName);
                user.set('nickname', newName);
            }
            if (newEmail !== user.getEmail()) {
                user.setEmail(newEmail);
                changes.emailChanged = true;
            }
            if (newPassword) {
                user.setPassword(newPassword);
                changes.passwordChanged = true;
            }

            await user.save();
            
            // 操作反馈
            let message = '信息更新成功';
            if (changes.emailChanged) message += '\n验证邮件已发送至新邮箱';
            if (changes.passwordChanged) message += '\n下次登录请使用新密码';
            alert(message);

            loadProfile();
        } catch (err) {
            alert('操作失败: ' + err.message);
        }
    });

    // 账户注销处理
    $('#deleteAccount').click(async () => {
        if (!confirm('确定永久删除账户？此操作将清除所有数据且不可恢复！')) return;
        
        try {
            await AV.User.current().destroy();
            await AV.User.logOut();
            alert('账户已永久删除');
            window.location.href = 'index.html';
        } catch (err) {
            alert('操作失败: ' + err.message);
        }
    });

    // 初始化加载
    $(document).ready(() => {
        if (!AV.User.current()) window.location.href = 'index.html';
        loadProfile();
    });
    </script>
</body>
</html>